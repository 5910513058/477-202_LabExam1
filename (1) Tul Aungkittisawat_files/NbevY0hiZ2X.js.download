if (self.CavalryLogger) { CavalryLogger.start_js(["t09ds"]); }

__d('NewsFeedOffscreenController',['Arbiter','CSS','DOMQuery','IntersectionObserver','NavigationMessage','Run','Style','SubscriptionsHandler','debounce','getOrCreateDOMID','queryThenMutateDOM'],(function a(b,c,d,e,f,g){var h=400,i=10,j={},k=null,l={rootMargin:h+'px 0px '+h+'px 0px'},m=null,n={};function o(){for(var w in n)if(c('DOMQuery').scry(n[w],'div[data-fullscreen]').length){delete n[w]}else j[w]=n[w].offsetHeight;}function p(){var w=void 0,x=void 0;for(var y in n){x=j[y];if(x!==undefined&&x>0){c('Style').set(n[y],'height',x+i+'px');w=n[y].firstElementChild;if(w)c('CSS').hide(w);delete j[y]}delete n[y]}}var q=c('debounce')(function(){c('queryThenMutateDOM')(o,p,'NewsFeedOffscreenController')});function r(w){delete n[c('getOrCreateDOMID')(w)];c('Style').set(w,'height','');var x=w.firstElementChild;if(x)c('CSS').show(x);}function s(w){var x=[];w.forEach(function(y){if(y.isIntersecting||y.intersectionRatio>0){x.push(y.target)}else n[c('getOrCreateDOMID')(y.target)]=y.target;});q();x.forEach(r)}function t(){k&&k.disconnect();k=null;m&&m.release();m=null}function u(){if(k)return k;k=new (c('IntersectionObserver'))(s,l);var w=new (c('SubscriptionsHandler'))();w.addSubscriptions(c('Arbiter').subscribe(c('NavigationMessage').NAVIGATION_BEGIN,t),c('Run').onLeave(t));return k}var v={attachSubstream:function w(x){u().observe(x)}};f.exports=v}),null);
__d('NewsFeedTailLoadController',['Arbiter','Bootloader','CSS','DOM','Event','IntersectionObserver','ListestandStreamTailStoryPlaceholderVisbilityTracker','LitestandMessages','LitestandStream','NavigationMessage','NewsFeedDedupeStoryController','NewsFeedOffscreenController','Run','SubscriptionsHandler','FunnelLogger','AsyncResponse','ge','getElementPosition','getOrCreateDOMID','getViewportDimensions'],(function a(b,c,d,e,f,g){var h=100,i=30000,j={'streamload.tail.commence':true,'streamload.tail.success':true,'streamload_error.tail':true,'streamload_error.tail.transport':true,'streamload_error.tail.final':true,'streamload.tail.retry':true,'streamload_error.tail.retry':true,'streamload.tail.retry.success':true,'streamload_timeout.tail':true},k=void 0,l=void 0,m={},n='WWW_NEWSFEED_TAILLOAD_FUNNEL',o=2,p=null,q=void 0,r=null,s=void 0,t=void 0,u=0,v=0,w=null,x=function ga(ha){ha.forEach(function(ia){if(j[ia])c('FunnelLogger').appendActionWithTag(n,v,ia,'try_'+u);});c('Bootloader').loadModules(["BanzaiODS"],function(ia){ha.forEach(function(ja){ia.bumpEntityKey('feed_load',ja)})},'NewsFeedTailLoadController')},y=function ga(ha,ia){c('Arbiter').inform(c('LitestandMessages').STREAM_LOAD_ERROR,ia);var ja=['streamload_error.tail'];if(u>0)ja.push('streamload_error.tail.retry');if(u<o){u++;ba(ha);ja.push('streamload.tail.retry');c('Arbiter').inform(c('LitestandMessages').STREAM_LOAD_RETRY)}else c('CSS').removeClass(t,'async_saving');x(ja)},z=function ga(){aa();q=setTimeout(function(){x(['streamload_timeout.tail'])},i)},aa=function ga(){q&&clearTimeout(q)},ba=function ga(ha){if(u<1){c('FunnelLogger').startFunnel(n,v);c('FunnelLogger').addFunnelTag(n,v,'NewsFeedTailLoadController')}x(['streamload.tail.commence']);if(m[ha]){x(['duplicate_cursor']);c('Arbiter').inform(c('LitestandMessages').DUPLICATE_CURSOR_ERROR,ha)}m[ha]=true;var ia={client_stories_count:c('DOM').scry(c('LitestandStream').getStreamRoot(),c('LitestandStream').getStoriesSelector()).length,cursor:ha,feed_stream_id:c('LitestandStream').getFeedStreamID(),pager_config:s,scroll_count:v+1,story_id:c('LitestandStream').getStoryID()},ja=function ma(na){y(ha,na)},ka=function ma(na){x(['streamload_error.tail.transport']);y(ha,na)},la=function ma(na){if(na.error){x(['streamload_error.tail.final'])}else{x(['streamload.tail.success']);v++}};if(!r){c('Bootloader').loadModules(["UIPagelet"],function(ma){r=ma.loadFromEndpoint('LitestandTailLoadPagelet',c('getOrCreateDOMID')(k),ia,{append:true,automatic:true,constHeight:true,crossPage:true,errorHandler:ja,finallyHandler:la,transportErrorHandler:ka,usePipe:true});c('Arbiter').inform(c('LitestandMessages').STORIES_REQUESTED)},'NewsFeedTailLoadController')}else{r.setErrorHandler(ja).setTransportErrorHandler(ka).go(ia);c('Arbiter').inform(c('LitestandMessages').STORIES_REQUESTED)}};function ca(){p&&p.disconnect();p=null;w&&w.release();w=null;m={};r=null;v=0;aa()}function da(event){ba(l);c('CSS').addClass(t,'async_saving');event.preventDefault()}function ea(ga){var ha=false;ga.forEach(function(ia){if(ia.target===t){var ja=ia.isIntersecting||ia.intersectionRatio>0;if(ja){ha=true;c('CSS').addClass(t,'async_saving');ba(l);p&&p.unobserve(t)}}});return ha}var fa={init:function ga(ha,ia,ja,ka,la){k=ja;l=ha;t=ia;s=ka;var ma=la.firstPagerScrollBuffer||h,na=c('getElementPosition')(ia),oa=c('getViewportDimensions')(),pa=Math.max(na.y-ma-oa.height,0);p=new (c('IntersectionObserver'))(function(qa){if(ea(qa)){p&&p.disconnect();p=new (c('IntersectionObserver'))(function(ra){ea(ra)},{rootMargin:'0px 0px '+la.bufferPixels+'px 0px'})}},{rootMargin:'0px 0px '+pa+'px 0px'});p.observe(t);c('ListestandStreamTailStoryPlaceholderVisbilityTracker').setPlaceholderElement(t);w=new (c('SubscriptionsHandler'))();w.addSubscriptions(c('Arbiter').subscribe(c('LitestandMessages').STORIES_REQUESTED,z),c('Arbiter').subscribe([c('LitestandMessages').STORIES_INSERTED,c('LitestandMessages').STREAM_LOAD_ERROR],aa),c('Arbiter').subscribe(c('NavigationMessage').NAVIGATION_BEGIN,ca),c('Event').listen(t,'click',da),c('Run').onLeave(ca))},destroy:function ga(){ca();c('CSS').hide(t)},setCursor:function ga(ha){var ia=c('LitestandStream').getStreamRoot();if(ia)c('NewsFeedDedupeStoryController').dedupe(ia,c('LitestandStream').getStoriesSelector());c('CSS').removeClass(t,'async_saving');l=ha;p&&p.observe(t);u=0},moreStoriesInserted:function ga(ha){c('Arbiter').inform(c('LitestandMessages').STORIES_INSERTED,{substream_id:ha});var ia=c('ge')(ha);if(ia){c('NewsFeedOffscreenController').attachSubstream(ia);if(u>0){u=0;x(['streamload.tail.retry.success'])}}},handleError:function ga(ha){y(ha)}};f.exports=fa}),null);